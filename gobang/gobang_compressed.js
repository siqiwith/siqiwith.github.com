/**
 * Copyright © 2013 Siqi. All Rights Reserved.
 * Licensed under the GPL license.
 */
$(function(){var e="https://siqigobang.firebaseIO.com/",t=16,n=16,r="",i="#759DC0",s="#ffffff",o=!0,u="",a=null,f=new Firebase(e),l=f.child("sessions"),c=f.child("users"),h=new FirebaseSimpleLogin(f,function(e,t){e||t==undefined||t.id==undefined?e&&alert(e):(a=t,$("#loginPane").css({display:"none"}),$("#userInfoPane").css({display:"block"}),$("#actionPane").css({display:"block"}),$("#userNameLabel").html(t.email))}),p=t*n;for(var d=0;d<n;d++)for(var v=0;v<t;v++)$("div#container").append('<div id="cell_'+d+"_"+v+'" class="cell"></div>');$("div#container").on("click",function(e){$(e.target).css({"background-color":o?i:s});var t=$(e.target).attr("id"),n=t.split("_"),r=l.child(u),a=r.child(o?"hostSteps":"guestSteps");a.push({x:n[2],y:n[1]})}),$("#login").on("click",function(){r=$("#userName").val(),password=$("#password").val(),h.login("password",{email:r,password:password,rememberMe:!1})}),$("#start").on("click",function(){u=$("#sessionName").val();var e=l.child(u);e.onDisconnect().remove();var t={host:a.id,hostSteps:[]};c.child(a.id).update({currentSession:u}),e.update(t,function(t){if(t)alert(t);else{o=!0,alert("Game started");var n=e.child(o?"guestSteps":"hostSteps");n.on("child_added",function(e){var t=e.val();$("#cell_"+t.y+"_"+t.x).css({"background-color":s})})}})}),$("#join").on("click",function(){u=$("#sessionName").val();var e=l.child(u);e.onDisconnect().remove();var t={guest:a.id,guestSteps:[]};c.child(a.id).update({currentSession:u}),e.update(t,function(t){if(t)alert(t);else{o=!1,alert("Joined Game!");var n=e.child(o?"guestSteps":"hostSteps");n.on("child_added",function(e){var t=e.val();$("#cell_"+t.y+"_"+t.x).css({"background-color":i})})}})})})